<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<style>
		.table {
			border-collapse: collapse;
			width: 100%;
			text-align: center;
			border-radius: 5px;
		}
		.table td {
			border: 1px solid #ccc;
			line-height: 2em;
			/*border-radius: 5px;*/
		}
		.table tr.current {
			background-color: #e6f7ff;
		}
		.none {
			display: none;
		}
		.btn {
			padding: .5em 1em;
			border-radius: 3px;
			background-color: lightblue;
			color: #ededed;
			cursor: pointer;
			display: inline-block;
		}
		.btns {
			margin-bottom: .5em;
		}
		input{
			border-radius: 4px;
		}

</style>
<script>

var baseURL = "http://134.175.154.93:6677";
function reloadData(){
	var url = baseURL+"/category/findAllCategory";
	$.get(url,function(response,status){
		//1.先将tbody清空
		$("#category_tbl tbody").empty();
		//2.追加新的值
		response.data.forEach(function(item){
			var newTr = $(`<tr>
				<td><input type="checkbox" value="`+item.id+`"></td>
				<td>`+item.name+`</td>
				<td>`+item.num+`</td>
				// <td>`+item.parentId+`</td>
				<td>
					<a class="btn_del" href="#">删除</a>
					<a class="btn_upd" href="#">修改</a>
				</td>
			</tr>`);
			$("#category_tbl").append(newTr)
		});
	});

		var tbody = document.getElementsByTagName("tbody")[0];
		//为表单绑定事件
		document.forms[0].onsubmit = function(event){
			//1.获取用户输入
			var id = $("id").value;
			var name = $("name").value;
			var num = $("num").value;
			var parentId = $("parentId").value;
			var url = baseURL+"/category/insertCategory";
			var data = {
				id:id,
				name:name,
				num:num,
				parentId:parentId
			};
			//2.异步交互给后台
			$.post(url,data,function(response){
				alert(response.message);
				reloadData();
			});
			
			//3.页面的局部更新
			event.preventDefault();
		}
		//给添加按钮绑定事件
		$("#btn_add").on("click",function(){
			// alert(1);
				document.querySelector("input[name=id]").value = "";
				document.querySelector("input[name=name]").value = "";
				document.querySelector("input[name=num]").value = "";
				document.querySelector("input[name=parentId]").value = "";	
		})
			//当光标移动的某一行上，为这一行添加背景
				tbody.onmouseover = function(event){
					var target = event.target;
					if(target.nodeName === "TD"){
						target.parentNode.className = "current"
					}
				}
				tbody.onmouseout = function(event){
					var target = event.target;
					if(target.nodeName === "TD"){
						target.parentNode.className = ""
					}
				}
				//给删除按钮绑定事件
				tbody.onclick = function(event){
								if(event.target.nodeName === "A"){
				switch(event.target.className){
					case "btn_del":
						// 1. 先获取要删除的id
						var id = event.target.parentNode.parentNode.firstElementChild.firstElementChild.value;
						// 2. 编写ajax进行删除
						var url = baseURL+"/category/deleteByCategoryId";
						var data = "id="+id;
						$.post(url,data,function(response,statusText){
							alert(response.amessage);
							reloadData();
						})
						break;
					case "btn_upd":
						var id = event.target.parentNode.parentNode.children[0].firstElementChild.value;
						var name = event.target.parentNode.parentNode.children[1].innerText;
						var num = event.target.parentNode.parentNode.children[2].innerText;
						var parentId = event.target.parentNode.parentNode.children[3].innerText;
						document.querySelector("input[name=id]").value = id;
						document.querySelector("input[name=name]").value = name;
						document.querySelector("input[name=num]").value = num;
						document.querySelector("input[name=parentId]").value = parentId;
						break;
				}
			}
		}
	}
//文档加载完毕后执行
$(function(){
	//调用重载数据
	reloadData();
})	
</script>

<div class="customer">
	<div class="btns">
		<div id="btn_add" class="btn">添加</div>
		<div id="btn_import" class="btn">批量导入</div>
	</div>
	
	<div style="margin-bottom: .5em">
		<!-- 表单 -->
		<form action="javascript:void(0)">
			<input type="hidden"/>

			编号<input type="text" name="id" class="id">
			分类名称<input type="text" name="name" class="name" />
			数量 <input type="text" name="num" class="num" />
			父Id<input type="text" name="parentId" class="parentId" />
			<input type="submit" value="提交">
		</form>
	</div>
	<table class="table" id="category_tbl">
		<thead>
			<tr>
				<td width="80px">编号</td>
				<td>分类名称</td>
				<td>数量</td>
				<td>父Id</td>
				<td width="100px">操作</td>
			</tr>
		</thead>
		<tbody>
			<tr class="none">
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td>
					<a class="btn_del" href="#">删除</a>
					<a class="btn_upd" href="#">修改</a>
				</td>
			</tr>	
		</tbody>
	</table>
</div>